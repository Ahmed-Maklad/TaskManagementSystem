@model Domain.ViewModels.ResultView<List<Application.DTOs.GetTasksDTO>>

@{
	ViewData["Title"] = "Task List";
	var isAdmin = User.IsInRole("Admin");
	int currentPage = (int)ViewData["CurrentPage"];
	int pageSize = (int)ViewData["PageSize"];
	int totalPages = (int)ViewData["TotalPages"];
}

<h2 class="text-center">Task List</h2>

<div class="text-end mb-3">
	<a class="btn btn-success" asp-action="Create">Create Task</a>
</div>
@if (!Model.IsSuccess)
{
	<div class="alert alert-warning">
		@ViewData["Message"] ?? "No tasks found."
	</div>
}
else if (Model.Data != null && Model.Data.Any())
{


	<table class="table table-bordered">
		<thead class="table-light">
			<tr>
				<th>Name</th>
				<th>Description</th>
				<th>Priority</th>
				<th>Due Date</th>
				<th>Assigned To</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var task in Model.Data)
			{
				<tr>
					<td>@task.Name</td>
					<td>@task.Description</td>
					<td>@task.Priority</td>
					<td>@task.DueDate.ToString("yyyy-MM-dd")</td>
					<td>@task.AssignedFullName</td>
					<td>
						<a class="btn btn-sm btn-info" asp-action="Details" asp-route-id="@task.Id">Details</a>
						@if (isAdmin)
						{
							<a class="btn btn-sm btn-warning" asp-action="Edit" asp-route-id="@task.Id">Edit</a>
							<a class="btn btn-sm btn-danger" asp-action="Delete" asp-route-id="@task.Id">Delete</a>
						}
					</td>
				</tr>
			}
		</tbody>
	</table>

	<div class="d-flex justify-content-center">
		<ul class="pagination">
			@if (currentPage > 1)
			{
				<li class="page-item">
					<a class="page-link" href="@Url.Action("GetAllTasks", new { pageNumber = currentPage - 1 })">Previous</a>
				</li>
			}
			else
			{
				<li class="page-item disabled">
					<a class="page-link" href="#">Previous</a>
				</li>
			}

			<li class="page-item active">
				<span class="page-link">@currentPage</span>
			</li>

			@if (currentPage < totalPages)
			{
				<li class="page-item">
					<a class="page-link" href="@Url.Action("GetAllTasks", new { pageNumber = currentPage + 1 })">Next</a>
				</li>
			}
			else
			{
				<li class="page-item disabled">
					<a class="page-link" href="#">Next</a>
				</li>
			}
		</ul>
	</div>
}
else
{
	<p>No tasks available.</p>
}

@section Scripts {
	<partial name="_ValidationScriptsPartial" />
}
